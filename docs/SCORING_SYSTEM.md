# 総合評価スコアシステム

## 概要
商品の総合評価スコアは、レビュー評価と単価を組み合わせて算出される5点満点のスコアです。
ユーザーが品質とコストパフォーマンスの両面から商品を評価できるように設計されています。

## 計算方法

### 1. ベイズ平均によるレビュースコアの調整
レビュー数が少ない商品の評価を適切に調整するため、ベイズ平均を使用しています。

```
調整レビュースコア = (レビュー数 × レビュー平均点 + C × m) / (レビュー数 + C)
```

- **C = 10**: 信頼性パラメータ（最小レビュー数の閾値）
- **m = 3.5**: 全商品の平均レビュー点数の推定値

この方式により、レビュー1件で5点の商品より、レビュー100件で4.5点の商品の方が高く評価されます。

### 2. 単価スコアの正規化
商品の単価を0-5点の範囲に正規化します。

```
単価スコア = ((最大単価 - 現在単価) / (最大単価 - 最小単価)) × 5
```

- トイレットペーパー: `price_per_m`（1メートルあたりの価格）
- 食器用洗剤: `price_per_1000ml`（1000mlあたりの価格）

価格が低いほどスコアが高くなります。

### 3. 総合スコアの計算
調整されたレビュースコアと単価スコアを重み付けして合算します。

```
総合スコア = レビュースコア × 0.7 + 単価スコア × 0.3
```

## 重み付けプリセット

現在は「品質重視」（QUALITY_FOCUSED）プリセットを使用しています：

| プリセット | レビュー重み | 価格重み | 用途 |
|---------|-----------|---------|------|
| BALANCED | 50% | 50% | バランス重視 |
| **QUALITY_FOCUSED** | **70%** | **30%** | **品質重視（現在使用中）** |
| PRICE_FOCUSED | 30% | 70% | コスパ重視 |

## 実装ファイル

### スコア計算ロジック
- `/lib/scoring.ts`
  - `calculateToiletPaperScore()`: トイレットペーパー用スコア計算
  - `calculateDishwashingScore()`: 食器用洗剤用スコア計算
  - `calculateAdjustedReviewScore()`: ベイズ平均計算
  - `calculatePriceScore()`: 単価スコア正規化

### UI実装
- `/components/ProductCard.tsx`
  - 総合スコアバッジの表示（小数第2位まで）
  - タップ式ツールチップで説明表示

### ページ実装
- `/app/toilet-paper/page.tsx`
- `/app/dishwashing-liquid/page.tsx`
  - 総合評価順ソート機能
  - スコア計算とエラーハンドリング

## 表示仕様

### スコアバッジ
- 位置: 各商品カードの単価表示の下
- 形式: 「総合: X.XX点」（小数第2位まで表示）
- 色: 黄色背景（#FFD814）、黒文字（#0F1111）

### ツールチップ
- トリガー: 「i」アイコンをタップ
- 内容: 「レビュー評価と単価を考慮した総合スコア（5点満点）」
- デバイス対応: PC・スマホ両対応（タップ式）

### ソート機能
- 「総合評価順」を選択可能
- スコアが高い順（降順）で表示
- 上位3商品には順位バッジを表示

## エラーハンドリング

- Infinity や NaN などの無効な値は0に置き換え
- エラー発生時はコンソールに警告を出力
- 価格情報がない場合はレビュースコアのみで評価

## 今後の拡張案

1. **動的な重み付け調整**
   - ユーザーが重み付けを選択できるUI
   - カテゴリごとの最適な重み付け

2. **追加評価要素**
   - 配送スピード
   - ブランド信頼度
   - 在庫状況

3. **スコアの可視化**
   - レーダーチャート表示
   - スコアの内訳表示

4. **パーソナライゼーション**
   - ユーザーの購入履歴に基づく重み付け調整
   - 好みの学習機能